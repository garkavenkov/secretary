"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[501],{2397:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(3645),a=n.n(i)()((function(e){return e[1]}));a.push([e.id,".crud-title[data-v-2cc74059]{height:40px;position:relative;text-align:center;vertical-align:middle;width:175px}.crud-title a[data-v-2cc74059]{position:absolute;right:8px;top:6px}table tbody tr[data-v-2cc74059]{vertical-align:middle}table tbody tr td[data-v-2cc74059]:first-of-type{align-items:center;display:flex;justify-content:space-between;padding-left:.5rem;padding-right:.5rem}a[data-v-2cc74059]:not([href]):not(.toggle-rights__disabled,.toggle-rights__all){color:grey}a[data-v-2cc74059]:not([href]):not(.toggle-rights__disabled,.toggle-rights__all):hover{color:#0076f9;font-weight:700;transform:scale(1.1)}.toggle-rights__disabled[data-v-2cc74059]{color:grey;cursor:not-allowed;opacity:.5;pointer-events:none;text-decoration:none}.toggle-rights__disabled.toggle-rights__all[data-v-2cc74059]{color:grey}.toggle-rights__all[data-v-2cc74059]{color:#0076f9;font-weight:700;transform:scale(1.5)}",""]);const o=a},8974:(e,t,n)=>{n.r(t),n.d(t,{default:()=>K});var i=n(8222),a=function(e){return(0,i.pushScopeId)("data-v-2cc74059"),e=e(),(0,i.popScopeId)(),e},o={class:"row"},r={class:"col-md-12"},l={class:"card"},s={class:"card-body"},c={class:"row mb-3"},d={class:"d-flex justify-content-between"},u={class:"d-flex align-items-center"},m=a((function(){return(0,i.createElementVNode)("span",{class:"me-2"},"Керування правами дозволу для",-1)})),h={class:"ms-3"},p={value:"0",disabled:""},g=["value"],f=a((function(){return(0,i.createElementVNode)("span",{class:"mdi mdi-pencil-off-outline me-1"},null,-1)})),E=a((function(){return(0,i.createElementVNode)("span",{class:"mdi mdi-pencil-outline me-1"},null,-1)})),V=["disabled"],b=a((function(){return(0,i.createElementVNode)("span",{class:"mdi mdi-content-save-outline me-1"},null,-1)})),v={class:"border-top pt-3"},N=a((function(){return(0,i.createElementVNode)("tr",null,[(0,i.createElementVNode)("th",{rowspan:"2",class:"align-middle"},"Назва"),(0,i.createElementVNode)("th",{colspan:"4",class:"text-center"},"Дозвіл")],-1)})),k={class:"crud-title"},_=["title"],w=[a((function(){return(0,i.createElementVNode)("span",{class:"mdi mdi-check-all"},null,-1)}))],y={class:"crud-title"},x=["title"],C=[a((function(){return(0,i.createElementVNode)("span",{class:"mdi mdi-check-all"},null,-1)}))],M={class:"crud-title"},B=["title"],G=[a((function(){return(0,i.createElementVNode)("span",{class:"mdi mdi-check-all"},null,-1)}))],P={class:"crud-title"},R=["title"],U=[a((function(){return(0,i.createElementVNode)("span",{class:"mdi mdi-check-all"},null,-1)}))],D=["onClick","title"],I=[a((function(){return(0,i.createElementVNode)("span",{class:"mdi mdi-check-all"},null,-1)}))],S={class:"text-center"},O=["onUpdate:modelValue","disabled"],T={class:"text-center"},F=["onUpdate:modelValue","disabled"],A={class:"text-center"},J=["onUpdate:modelValue","disabled"],z={class:"text-center"},Z=["onUpdate:modelValue","disabled"];const j={name:"PermissionRightsMain",components:{DataTable:n(4806).Z},data:function(){return{ownerId:0,rightsFor:"role",owners:[],permissions:[],_permissions:[],inEditMode:!1}},methods:{fetchRoles:function(){var e=this;axios.get("/api/v1/roles").then((function(t){e.owners=t.data.data}))},fetchUsers:function(){var e=this;axios.get("/api/v1/users").then((function(t){e.owners=t.data.data}))},fetchOwnerPermissions:function(){var e=this;axios.get("/api/v1/granted-permissions?type=".concat(this.rightsFor,"&owner=").concat(this.ownerId)).then((function(t){e.permissions=t.data.data}))},toggleAction:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1);this["all".concat(t,"Granted")]?this.permissions.forEach((function(t){return t[e]=!1})):this.permissions.forEach((function(t){return t[e]=!0}))},toggleRight:function(e){var t=this.permissions.find((function(t){return t.id==e.id}));e.create&&e.read&&e.update&&e.delete?(t.create=!1,t.read=!1,t.update=!1,t.delete=!1):(t.create=!0,t.read=!0,t.update=!0,t.delete=!0)},editPermissionRights:function(){this.inEditMode=!0,this._permissions=JSON.parse(JSON.stringify(this.permissions))},cancelEditingPermissionRights:function(){this.inEditMode=!1,this.permissions=JSON.parse(JSON.stringify(this._permissions))},grantPermission:function(){var e=this,t={};t.owner_type=this.rightsFor,0!=this.ownerId&&(t.owner=this.ownerId,t.rights=this.permissions.map((function(e){var t=0;return e.create&&(t+=8),e.read&&(t+=4),e.update&&(t+=2),e.delete&&(t+=1),"".concat(e.id,":").concat(t)})).join(","),axios.post("/api/v1/grant-permissions",t).then((function(t){200==t.status&&(e.$toast(t.data.message),e.fetchOwnerPermissions(),e.inEditMode=!1)})))}},computed:{chooseOwner:function(){return"role"==this.rightsFor?"оберіть роль":"user"==this.rightsFor?"оберіть користувача":void 0},allReadGranted:function(){return!this.permissions.some((function(e){return!e.read}))},allCreateGranted:function(){return!this.permissions.some((function(e){return!e.create}))},allUpdateGranted:function(){return!this.permissions.some((function(e){return!e.update}))},allDeleteGranted:function(){return!this.permissions.some((function(e){return!e.delete}))},readyForGrantPermission:function(){return JSON.stringify(this.permissions)!=JSON.stringify(this._permissions)}},watch:{rightsFor:function(e){"role"==e?(this.ownerId=0,this.fetchRoles()):"user"==e&&(this.ownerId=0,this.fetchUsers())},ownerId:function(e){0!==e&&this.fetchOwnerPermissions()}},created:function(){this.fetchRoles()}};var L=n(3379),$=n.n(L),q=n(2397),H={insert:"head",singleton:!1};$()(q.Z,H);q.Z.locals;const K=(0,n(3744).Z)(j,[["render",function(e,t,n,a,j,L){var $=(0,i.resolveComponent)("DataTable");return(0,i.openBlock)(),(0,i.createElementBlock)("div",o,[(0,i.createElementVNode)("div",r,[(0,i.createElementVNode)("div",l,[(0,i.createElementVNode)("div",s,[(0,i.createElementVNode)("div",c,[(0,i.createElementVNode)("div",d,[(0,i.createElementVNode)("div",u,[m,(0,i.createElementVNode)("div",h,[(0,i.withDirectives)((0,i.createElementVNode)("select",{class:"form-select",style:{padding:"0.175rem 2.5rem 0.175rem 1rem",width:"250px"},id:"role","onUpdate:modelValue":t[0]||(t[0]=function(e){return j.ownerId=e})},[(0,i.createElementVNode)("option",p,(0,i.toDisplayString)(L.chooseOwner),1),((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(j.owners,(function(e){return(0,i.openBlock)(),(0,i.createElementBlock)("option",{value:e.id,key:e.id},(0,i.toDisplayString)(e.name),9,g)})),128))],512),[[i.vModelSelect,j.ownerId]])])]),(0,i.createElementVNode)("div",null,[j.inEditMode?((0,i.openBlock)(),(0,i.createElementBlock)("button",{key:0,class:"btn btn-sm btn-outline-danger",title:"Відмінити редагування прав",onClick:t[1]||(t[1]=function(){return L.cancelEditingPermissionRights&&L.cancelEditingPermissionRights.apply(L,arguments)})},[f,(0,i.createTextVNode)(" Відмінити ")])):(0,i.createCommentVNode)("",!0),!j.inEditMode&&j.permissions.length>0?((0,i.openBlock)(),(0,i.createElementBlock)("button",{key:1,class:"btn btn-sm btn-outline-primary btn-transparent",title:"Редагування прав дозволу",onClick:t[2]||(t[2]=function(){return L.editPermissionRights&&L.editPermissionRights.apply(L,arguments)})},[E,(0,i.createTextVNode)(" Редагувати ")])):(0,i.createCommentVNode)("",!0),j.inEditMode?((0,i.openBlock)(),(0,i.createElementBlock)("button",{key:2,class:"btn btn-sm btn-outline-success ms-2",title:"Встановити права дозволи",disabled:!L.readyForGrantPermission,onClick:t[3]||(t[3]=function(){return L.grantPermission&&L.grantPermission.apply(L,arguments)})},[b,(0,i.createTextVNode)(" Встановити ")],8,V)):(0,i.createCommentVNode)("",!0)])])]),(0,i.createElementVNode)("div",v,[j.permissions.length>0?((0,i.openBlock)(),(0,i.createBlock)($,{key:0,dataTable:j.permissions,tableClass:"table-sm table-bordered"},{header:(0,i.withCtx)((function(){return[N,(0,i.createElementVNode)("tr",null,[(0,i.createElementVNode)("th",k,[(0,i.createTextVNode)(" читання "),(0,i.createElementVNode)("a",{onClick:t[4]||(t[4]=function(e){return L.toggleAction("read")}),title:L.allReadGranted?"Скаcувати дозвіл":"Надати дозвіл",class:(0,i.normalizeClass)({"toggle-rights__disabled":!j.inEditMode,"toggle-rights__all":L.allReadGranted})},w,10,_)]),(0,i.createElementVNode)("th",y,[(0,i.createTextVNode)(" створення "),(0,i.createElementVNode)("a",{onClick:t[5]||(t[5]=function(e){return L.toggleAction("create")}),title:L.allCreateGranted?"Скаcувати дозвіл":"Надати дозвіл",class:(0,i.normalizeClass)({"toggle-rights__disabled":!j.inEditMode,"toggle-rights__all":L.allCreateGranted})},C,10,x)]),(0,i.createElementVNode)("th",M,[(0,i.createTextVNode)(" редагування "),(0,i.createElementVNode)("a",{onClick:t[6]||(t[6]=function(e){return L.toggleAction("update")}),title:L.allUpdateGranted?"Скаcувати дозвіл":"Надати дозвіл",class:(0,i.normalizeClass)({"toggle-rights__disabled":!j.inEditMode,"toggle-rights__all":L.allUpdateGranted})},G,10,B)]),(0,i.createElementVNode)("th",P,[(0,i.createTextVNode)(" видалення "),(0,i.createElementVNode)("a",{onClick:t[7]||(t[7]=function(e){return L.toggleAction("delete")}),title:L.allDeleteGranted?"Скаcувати дозвіл":"Надати дозвіл",class:(0,i.normalizeClass)({"toggle-rights__disabled":!j.inEditMode,"toggle-rights__all":L.allDeleteGranted})},U,10,R)])])]})),default:(0,i.withCtx)((function(e){return[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)(e.paginatedData,(function(e){return(0,i.openBlock)(),(0,i.createElementBlock)("tr",{key:e.id},[(0,i.createElementVNode)("td",null,[(0,i.createElementVNode)("span",null,(0,i.toDisplayString)(e.name),1),(0,i.createElementVNode)("a",{onClick:function(t){return L.toggleRight(e)},title:e.create&&e.read&&e.update&&e.delete?"Скасувати всі дозволи":"Надати всі дозволи",class:(0,i.normalizeClass)({"toggle-rights__disabled":!j.inEditMode,"toggle-rights__all":e.create&&e.read&&e.update&&e.delete})},I,10,D)]),(0,i.createElementVNode)("td",S,[(0,i.withDirectives)((0,i.createElementVNode)("input",{type:"checkbox",name:"",id:"","onUpdate:modelValue":function(t){return e.read=t},value:"4",disabled:!j.inEditMode},null,8,O),[[i.vModelCheckbox,e.read]])]),(0,i.createElementVNode)("td",T,[(0,i.withDirectives)((0,i.createElementVNode)("input",{type:"checkbox",name:"",id:"","onUpdate:modelValue":function(t){return e.create=t},value:"8",disabled:!j.inEditMode},null,8,F),[[i.vModelCheckbox,e.create]])]),(0,i.createElementVNode)("td",A,[(0,i.withDirectives)((0,i.createElementVNode)("input",{type:"checkbox",name:"",id:"","onUpdate:modelValue":function(t){return e.update=t},value:"2",disabled:!j.inEditMode},null,8,J),[[i.vModelCheckbox,e.update]])]),(0,i.createElementVNode)("td",z,[(0,i.withDirectives)((0,i.createElementVNode)("input",{type:"checkbox",name:"",id:"","onUpdate:modelValue":function(t){return e.delete=t},value:"1",disabled:!j.inEditMode},null,8,Z),[[i.vModelCheckbox,e.delete]])])])})),128))]})),_:1},8,["dataTable"])):(0,i.createCommentVNode)("",!0)])])])])])}],["__scopeId","data-v-2cc74059"]])}}]);