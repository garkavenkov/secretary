"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[501],{1426:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(3645),s=n.n(i)()((function(e){return e[1]}));s.push([e.id,".crud-title[data-v-471f938a]{height:40px;position:relative;text-align:center;vertical-align:middle;width:175px}.crud-title a[data-v-471f938a]{position:absolute;right:8px;top:6px}table tbody tr[data-v-471f938a]{vertical-align:middle}table tbody tr td[data-v-471f938a]:first-of-type{align-items:center;display:flex;justify-content:space-between;padding-left:.5rem;padding-right:.5rem}a[data-v-471f938a]:not([href]):not(.toggle-rights__disabled,.toggle-rights__all){color:grey}a[data-v-471f938a]:not([href]):not(.toggle-rights__disabled,.toggle-rights__all):hover{color:#0076f9;font-weight:700;transform:scale(1.1)}.toggle-rights__disabled[data-v-471f938a]{color:grey;cursor:not-allowed;opacity:.5;pointer-events:none;text-decoration:none}.toggle-rights__disabled.toggle-rights__all[data-v-471f938a]{color:grey}.toggle-rights__all[data-v-471f938a]{color:#0076f9;font-weight:700;transform:scale(1.5)}",""]);const a=s},3798:(e,t,n)=>{n.r(t),n.d(t,{default:()=>$});var i=n(8222),s=function(e){return(0,i.dD)("data-v-471f938a"),e=e(),(0,i.Cn)(),e},a={class:"row"},r={class:"col-md-12"},l={class:"card"},o={class:"card-body"},d={class:"row mb-3"},c={class:"d-flex justify-content-between"},u={class:"d-flex align-items-center"},g=s((function(){return(0,i._)("span",{class:"me-2"},"Керування правами дозволу для",-1)})),h={class:"ms-3"},p={value:"0",disabled:""},f=["value"],m=s((function(){return(0,i._)("span",{class:"mdi mdi-pencil-off-outline me-1"},null,-1)})),_=s((function(){return(0,i._)("span",{class:"mdi mdi-pencil-outline me-1"},null,-1)})),b=["disabled"],w=s((function(){return(0,i._)("span",{class:"mdi mdi-content-save-outline me-1"},null,-1)})),v={class:"border-top pt-3"},k=s((function(){return(0,i._)("tr",null,[(0,i._)("th",{rowspan:"2",class:"align-middle"},"Назва"),(0,i._)("th",{colspan:"4",class:"text-center"},"Дозвіл")],-1)})),y={class:"crud-title"},x=["title"],C=[s((function(){return(0,i._)("span",{class:"mdi mdi-check-all"},null,-1)}))],U={class:"crud-title"},E=["title"],M=[s((function(){return(0,i._)("span",{class:"mdi mdi-check-all"},null,-1)}))],D={class:"crud-title"},G=["title"],P=[s((function(){return(0,i._)("span",{class:"mdi mdi-check-all"},null,-1)}))],R={class:"crud-title"},O=["title"],I=[s((function(){return(0,i._)("span",{class:"mdi mdi-check-all"},null,-1)}))],V=["onClick","title"],F=[s((function(){return(0,i._)("span",{class:"mdi mdi-check-all"},null,-1)}))],A={class:"text-center"},J=["onUpdate:modelValue","disabled"],N={class:"text-center"},S=["onUpdate:modelValue","disabled"],Z={class:"text-center"},j=["onUpdate:modelValue","disabled"],q={class:"text-center"},T=["onUpdate:modelValue","disabled"];const z={name:"PermissionRightsMain",components:{DataTable:n(366).Z},data:function(){return{ownerId:0,rightsFor:"role",owners:[],permissions:[],_permissions:[],inEditMode:!1}},methods:{fetchRoles:function(){var e=this;axios.get("/api/v1/roles").then((function(t){e.owners=t.data.data}))},fetchUsers:function(){var e=this;axios.get("/api/v1/users").then((function(t){e.owners=t.data.data}))},fetchOwnerPermissions:function(){var e=this;axios.get("/api/v1/granted-permissions?type=".concat(this.rightsFor,"&owner=").concat(this.ownerId)).then((function(t){e.permissions=t.data.data}))},toggleAction:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1);this["all".concat(t,"Granted")]?this.permissions.forEach((function(t){return t[e]=!1})):this.permissions.forEach((function(t){return t[e]=!0}))},toggleRight:function(e){var t=this.permissions.find((function(t){return t.id==e.id}));e.create&&e.read&&e.update&&e.delete?(t.create=!1,t.read=!1,t.update=!1,t.delete=!1):(t.create=!0,t.read=!0,t.update=!0,t.delete=!0)},editPermissionRights:function(){this.inEditMode=!0,this._permissions=JSON.parse(JSON.stringify(this.permissions))},cancelEditingPermissionRights:function(){this.inEditMode=!1,this.permissions=JSON.parse(JSON.stringify(this._permissions))},grantPermission:function(){var e=this,t={};t.owner_type=this.rightsFor,0!=this.ownerId&&(t.owner=this.ownerId,t.rights=this.permissions.map((function(e){var t=0;return e.create&&(t+=8),e.read&&(t+=4),e.update&&(t+=2),e.delete&&(t+=1),"".concat(e.id,":").concat(t)})).join(","),axios.post("/api/v1/grant-permissions",t).then((function(t){200==t.status&&(e.$toast(t.data.message),e.fetchOwnerPermissions(),e.inEditMode=!1)})))}},computed:{chooseOwner:function(){return"role"==this.rightsFor?"оберіть роль":"user"==this.rightsFor?"оберіть користувача":void 0},allReadGranted:function(){return!this.permissions.some((function(e){return!e.read}))},allCreateGranted:function(){return!this.permissions.some((function(e){return!e.create}))},allUpdateGranted:function(){return!this.permissions.some((function(e){return!e.update}))},allDeleteGranted:function(){return!this.permissions.some((function(e){return!e.delete}))},readyForGrantPermission:function(){return JSON.stringify(this.permissions)!=JSON.stringify(this._permissions)}},watch:{rightsFor:function(e){"role"==e?(this.ownerId=0,this.fetchRoles()):"user"==e&&(this.ownerId=0,this.fetchUsers())},ownerId:function(e){0!==e&&this.fetchOwnerPermissions()}},created:function(){this.fetchRoles()}};var H=n(3379),Y=n.n(H),K=n(1426),W={insert:"head",singleton:!1};Y()(K.Z,W);K.Z.locals;const $=(0,n(3744).Z)(z,[["render",function(e,t,n,s,z,H){var Y=(0,i.up)("breadcrumbs"),K=(0,i.up)("DataTable");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(Y),(0,i._)("div",a,[(0,i._)("div",r,[(0,i._)("div",l,[(0,i._)("div",o,[(0,i._)("div",d,[(0,i._)("div",c,[(0,i._)("div",u,[g,(0,i._)("div",h,[(0,i.wy)((0,i._)("select",{class:"form-select",style:{padding:"0.175rem 2.5rem 0.175rem 1rem",width:"250px"},id:"role","onUpdate:modelValue":t[0]||(t[0]=function(e){return z.ownerId=e})},[(0,i._)("option",p,(0,i.zw)(H.chooseOwner),1),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(z.owners,(function(e){return(0,i.wg)(),(0,i.iD)("option",{value:e.id,key:e.id},(0,i.zw)(e.name),9,f)})),128))],512),[[i.bM,z.ownerId]])])]),(0,i._)("div",null,[z.inEditMode?((0,i.wg)(),(0,i.iD)("button",{key:0,class:"btn btn-sm btn-outline-danger",title:"Відмінити редагування прав",onClick:t[1]||(t[1]=function(){return H.cancelEditingPermissionRights&&H.cancelEditingPermissionRights.apply(H,arguments)})},[m,(0,i.Uk)(" Відмінити ")])):(0,i.kq)("",!0),!z.inEditMode&&z.permissions.length>0?((0,i.wg)(),(0,i.iD)("button",{key:1,class:"btn btn-sm btn-outline-primary btn-transparent",title:"Редагування прав дозволу",onClick:t[2]||(t[2]=function(){return H.editPermissionRights&&H.editPermissionRights.apply(H,arguments)})},[_,(0,i.Uk)(" Редагувати ")])):(0,i.kq)("",!0),z.inEditMode?((0,i.wg)(),(0,i.iD)("button",{key:2,class:"btn btn-sm btn-outline-success ms-2",title:"Встановити права дозволи",disabled:!H.readyForGrantPermission,onClick:t[3]||(t[3]=function(){return H.grantPermission&&H.grantPermission.apply(H,arguments)})},[w,(0,i.Uk)(" Встановити ")],8,b)):(0,i.kq)("",!0)])])]),(0,i._)("div",v,[z.permissions.length>0?((0,i.wg)(),(0,i.j4)(K,{key:0,dataTable:z.permissions,tableClass:"table-sm table-bordered"},{header:(0,i.w5)((function(){return[k,(0,i._)("tr",null,[(0,i._)("th",y,[(0,i.Uk)(" читання "),(0,i._)("a",{onClick:t[4]||(t[4]=function(e){return H.toggleAction("read")}),title:H.allReadGranted?"Скаcувати дозвіл":"Надати дозвіл",class:(0,i.C_)({"toggle-rights__disabled":!z.inEditMode,"toggle-rights__all":H.allReadGranted})},C,10,x)]),(0,i._)("th",U,[(0,i.Uk)(" створення "),(0,i._)("a",{onClick:t[5]||(t[5]=function(e){return H.toggleAction("create")}),title:H.allCreateGranted?"Скаcувати дозвіл":"Надати дозвіл",class:(0,i.C_)({"toggle-rights__disabled":!z.inEditMode,"toggle-rights__all":H.allCreateGranted})},M,10,E)]),(0,i._)("th",D,[(0,i.Uk)(" редагування "),(0,i._)("a",{onClick:t[6]||(t[6]=function(e){return H.toggleAction("update")}),title:H.allUpdateGranted?"Скаcувати дозвіл":"Надати дозвіл",class:(0,i.C_)({"toggle-rights__disabled":!z.inEditMode,"toggle-rights__all":H.allUpdateGranted})},P,10,G)]),(0,i._)("th",R,[(0,i.Uk)(" видалення "),(0,i._)("a",{onClick:t[7]||(t[7]=function(e){return H.toggleAction("delete")}),title:H.allDeleteGranted?"Скаcувати дозвіл":"Надати дозвіл",class:(0,i.C_)({"toggle-rights__disabled":!z.inEditMode,"toggle-rights__all":H.allDeleteGranted})},I,10,O)])])]})),default:(0,i.w5)((function(e){return[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.paginatedData,(function(e){return(0,i.wg)(),(0,i.iD)("tr",{key:e.id},[(0,i._)("td",null,[(0,i._)("span",null,(0,i.zw)(e.name),1),(0,i._)("a",{onClick:function(t){return H.toggleRight(e)},title:e.create&&e.read&&e.update&&e.delete?"Скасувати всі дозволи":"Надати всі дозволи",class:(0,i.C_)({"toggle-rights__disabled":!z.inEditMode,"toggle-rights__all":e.create&&e.read&&e.update&&e.delete})},F,10,V)]),(0,i._)("td",A,[(0,i.wy)((0,i._)("input",{type:"checkbox",name:"",id:"","onUpdate:modelValue":function(t){return e.read=t},value:"4",disabled:!z.inEditMode},null,8,J),[[i.e8,e.read]])]),(0,i._)("td",N,[(0,i.wy)((0,i._)("input",{type:"checkbox",name:"",id:"","onUpdate:modelValue":function(t){return e.create=t},value:"8",disabled:!z.inEditMode},null,8,S),[[i.e8,e.create]])]),(0,i._)("td",Z,[(0,i.wy)((0,i._)("input",{type:"checkbox",name:"",id:"","onUpdate:modelValue":function(t){return e.update=t},value:"2",disabled:!z.inEditMode},null,8,j),[[i.e8,e.update]])]),(0,i._)("td",q,[(0,i.wy)((0,i._)("input",{type:"checkbox",name:"",id:"","onUpdate:modelValue":function(t){return e.delete=t},value:"1",disabled:!z.inEditMode},null,8,T),[[i.e8,e.delete]])])])})),128))]})),_:1},8,["dataTable"])):(0,i.kq)("",!0)])])])])])],64)}],["__scopeId","data-v-471f938a"]])}}]);